# Android App结构设计原则(译文)
## 原文：[Guide to App Architecture](https://developer.android.com/topic/libraries/architecture/guide.html#guiding_principles)
本文适合正在构建工程基本结构或者想要获取使App结构更加健壮、质量更高的建议和练习的开发者。

* ## **App开发者遇到的常见问题**

与传统的在大多数情况下只有单入口和单进程的桌面程序开发不同，Android app有复杂的多的结构。一个典型的Andriod app是由许多app组件构成的，包括activities、fragments、services、content providers和broadcast receivers。

这其中大部分的组件都声明在应用清单（Manifest）中，Android系统通过app清单来把你的app融入用户设备的整体用户体验中。当然，之前提到，一个桌面app程序通常运行在单进程上，然而，一个正确编写的Android app需要更加的灵活，因为用户总是在不同的app间不断切换来完成他们需求，使得app也在不同的流程和任务间切换。

举例来说，试想你是如何把照片发布到你最喜爱的社交app上的。首先，社交app触发一个拍照的intent，Android系统通过这个intent来启动相机app并处理其中的请求。此时，用户离开了社交app，但是用户对App的体验是持续的。然而，此过程中相机app可能会触发其他intent，比如启动一个文件选择器，这又会启动另一个app。最终，用户又返回了社交app并且发布了照片。在此过程中，用户随时可能会被打来的电话中断操作，然后打完电话后再回来继续分享照片。

在Android中，在不同app间跳转是很常见的，所以你的app必须正确的处理这些流程。记住，手机设备的资源是有限的，所以，在任何时候，系统可能通过杀死一些旧的app来为新的app腾出空间。

如上所述，你的app各个组件可能按正常顺序动也可能不按顺序启动，或者在任何时间被用户或者系统销毁。因为，app组件的生命周期是短暂的并且是不受你控制的，**你不应该在app组件中存储任何数据**并且你的app组件不应该相互依赖。

* ## **常用的结构设计规则**

如果你不能使用app组件来存储数据，那么app应该如何设计呢？

首先，你最应该关注的是如何在app中分离关注点(separation of concerns，如模块化设计)。把所有的代码写在一个Activity或一个Fragment中是一个常见的错误。任何与UI操作无关或与系统交互无关的代码都不应该出现在这些类中。尽量保持这些类的简洁，能让你避免很多因为生命周期产生的问题。不要忘了这些类并不归你所有，它们只是体现了你的app和系统之间的耦合。最好对最大程度的减少对这些类的依赖，来为用户提供坚实的用户体验。

其次，你应该**使用模型(model)来管理你的UI**，最好是持久化的模型。持久化是出于两个原因：你的用户不会在系统为了释放资源而销毁你的app时丢失任何数据，并且你的app甚至可以在网络不佳或者没有网络时继续工作。Model是用来为app处理数据的组件。它们是独立于app控件和系统组件的，因此，它们和这些组件的生命周期无关的。保持UI代码简洁并且和逻辑无关将会使管理更加简单。根据职责明确的数据管理model来设计app，将会更方便测试，并且使你的app更流畅。

* ## **建议的app设计方案**

在这个部分，我们通过示例来演示如何使用Architecture Components(Google推出的几个结构设计组件库)来设计一个app的结构。

> **注意**：没有任何一种方法能够适合所有情况。虽然如此，但是这个建议的结构设计方案可以为大多数情况提供一个良好的开端。如果你已经有了一个好的设计方案，你不需要为此改变。

试想我们正在构建用户资料的UI部分。这份用户资料将会通过我们后端的REST API来获取。

* ## **构建用户界面**

这个UI将会包括一个fragment `UserProfileFragment.java`和它相应的布局文件`user_profile_layout.xml`

为了控制UI，我们的数据model需要保持两个数据：

 1. User ID：用户的标识。最好使用fragment的参数列表来传递这个参数。如果系统销毁了你的进程，这条数据将会被保存下来以便于你的app下次启动时使用。

 1. User object：一个POJO（只有属性没有方法的Java类）保存用户数据

 我们将会创建一个基于ViewModel的UserProfileViewModel类来保存用户数据。

一个ViewModel为一个特定的组件如activity和fragment提供数据，并且处理和业务逻辑代码的通讯，如通知其它组件加载数据或者转发用户的修改。ViewModel并不知道View的信息并且不会被`configure change`影响，例如由于设备旋转造成的activity重新创建。